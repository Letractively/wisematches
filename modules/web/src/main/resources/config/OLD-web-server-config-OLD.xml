<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">

    <import resource="classpath:/config/game-scribble-config-old.xml"/>


    <bean id="rememberTokenDao" class="wisematches.server.deprecated.web.modules.login.tokens.RememberTokenDao">
        <property name="sessionFactory" ref="sessionFactory"/>
    </bean>

    <bean id="accountRecoveryManager" class="wisematches.server.web.services.recovery.RecoveryTokenManager">
        <property name="sessionFactory" ref="sessionFactory"/>
    </bean>

    <bean id="problemsReportDao" class="wisematches.server.deprecated.web.modules.core.problems.ProblemsReportDao">
        <property name="sessionFactory" ref="sessionFactory"/>
    </bean>

    <bean id="playerSettingsDao" class="wisematches.server.deprecated.web.modules.app.settings.ApplicationSettingsDao">
        <property name="sessionFactory" ref="sessionFactory"/>
    </bean>

    <bean id="sessionCustomHouse" class="wisematches.server.deprecated.web.server.sessions.WebSessionCustomHouseImpl">
        <property name="loginSessionTimeout" value="300"/>
        <property name="logoutSessionTimeout" value="1800"/>

        <property name="playerManager" ref="playerManager"/>
    </bean>

    <bean id="playerSessionsManager" class="wisematches.server.utils.sessions.impl.PlayerSessionsManagerImpl">
        <property name="playerManager" ref="playerManager"/>

        <property name="playerCustomHouses">
            <list>
                <ref bean="sessionCustomHouse"/>
            </list>
        </property>

        <property name="playerSessionBeanInterfaces">
            <list>
                <value>wisematches.server.deprecated.web.modules.app.sessions.PlayerEventsQueueBean</value>
                <value>wisematches.server.deprecated.web.modules.app.playboard.PlayerOpenBoardsBean</value>
            </list>
        </property>
    </bean>

    <bean id="memoryWordsManager" class="wisematches.server.gameplaying.scribble.memory.MemoryWordsManager">
        <property name="sessionFactory" ref="sessionFactory"/>
    </bean>

    <bean id="gameboardEventProducer"
          class="wisematches.server.deprecated.web.modules.app.events.producers.GameBoardEventProducer">
        <property name="playerManager" ref="playerManager"/>
        <property name="roomManagerFacade" ref="scribbleRoomManagerFacade"/>
    </bean>

    <bean id="playerEventProducer"
          class="wisematches.server.deprecated.web.modules.app.events.producers.PlayerEventProducer">
        <property name="playerStatisticsManager" ref="playerStatisticsManager"/>
        <property name="accountLockManager" ref="accountLockManager"/>
    </bean>

    <bean id="projectEventProducer"
          class="wisematches.server.deprecated.web.modules.app.events.producers.ProjectEventProducer">
        <property name="ratingManager" ref="ratingManager"/>
    </bean>

    <bean id="eventRouter" class="wisematches.server.deprecated.web.modules.app.events.EventRouter"
          destroy-method="close">
        <property name="eventEnginesCount" value="1"/>
        <property name="playerSessionsManager" ref="playerSessionsManager"/>

        <property name="eventProducers">
            <list>
                <ref bean="gameboardEventProducer"/>
                <ref bean="playerEventProducer"/>
                <ref bean="projectEventProducer"/>
            </list>
        </property>
    </bean>

    <bean id="notificationsSender"
          class="wisematches.server.deprecated.web.modules.app.notification.EMailNotificationsSender"
          destroy-method="destroy">
        <property name="roomsManager" ref="roomsManager"/>
        <property name="mailSender" ref="mailSender"/>
        <property name="playerManager" ref="playerManager"/>
        <property name="gameTimeoutProcessor" ref="gameTimeoutProcessor"/>
        <property name="playerSessionsManager" ref="playerSessionsManager"/>
        <property name="transactionTemplate" ref="transactionTemplateRequiredNew"/>
    </bean>

    <bean id="sessionNotificationBean" class="wisematches.server.deprecated.web.sessions.SessionNotificationBean">
        <property name="httpSessionListeners">
            <list>
                <bean class="wisematches.server.deprecated.web.modules.app.sessions.impl.HttpSessionCustomHouse">
                    <property name="sessionCustomHouse" ref="sessionCustomHouse"/>
                </bean>
            </list>
        </property>
    </bean>

    <alias alias="sessionFactory" name="webSessionFactory"/>
</beans>
