<html>
<body>

<!--http://javascript.ru/ui/draganddrop#vizualnoe-peremeshchenie-elementa-->
<!--http://javascript.ru/tutorial/object/inheritance#factory-->


<style type="text/css">
    #playboard {
        width: 342px !important;
        height: 366px !important;
        background-image: url('../../resources/images/scribble/board/scribble_field.png');
    }

    #board {
        position: relative !important;
        left: 6px !important;
        top: 6px !important;
        width: 332px !important;
        height: 332px !important;
    }

    #hand {
        position: relative;
        left: 95px;
        top: 9px;
    }

    .cell, .tile {
        width: 22px !important;
        height: 22px !important;
    }

    .tile {
        cursor: default;
        color: white;

        font-size: 12px;
        font-family: arial serif;

        -moz-user-select: none;
        -khtml-user-select: none;
        user-select: none;

        vertical-align: middle;
        text-align: center;
        display: table-cell;

        background: url(../../resources/images/scribble/board/tiles.png) no-repeat;
    }

    .tile sub {
        font-family: serif;
        font-size: 70%;
        font-weight: normal;
    }

    .tile0 {
        color: black;
    }

    .tile1, .tile2, .tile3, .tile4, .tile5, .tile6, .tile7, .tile8, .tile9, .tile10 {
        color: white;
    }

    .tile-selected {
        font-weight: bold;
    }

    .bonus-cell-2l {
        background: url(../../resources/images/scribble/board/bonus_2l.gif) no-repeat center;
    }

    .bonus-cell-3l {
        background: url(../../resources/images/scribble/board/bonus_3l.gif) no-repeat center;
    }

    .bonus-cell-2w {
        background: url(../../resources/images/scribble/board/bonus_2w.gif) no-repeat center;
    }

    .bonus-cell-3w {
        background: url(../../resources/images/scribble/board/bonus_3w.gif) no-repeat center;
    }

    .bonus-cell-center {
        background: url(../../resources/images/scribble/board/bonus_center.png) no-repeat center;
    }
</style>

<script type="text/javascript">
    wm = {};

    wm.scribble = {};

    wm.scribble.ScoreEngine = function() {
        var bonuses = new Array(15);
        var emptyHandBonus;

        for (var i = 0; i < 15; i++) {
            bonuses[i] = new Array(15);
        }

        this.BonusType = { DL: {name: '2l'}, TL: {name: '3l'}, DW: {name: '2w'}, TW: {name: '3w'} };

        bonuses[0][0] = this.BonusType.DL;
        bonuses[1][3] = this.BonusType.TL;
        bonuses[3][3] = this.BonusType.DW;
        bonuses[7][5] = this.BonusType.TW;

        this.init = function(bonuses, emptyHandBonus) {
            this.bonuses = bonuses;
            this.emptyHandBonus = emptyHandBonus;
        };

        this.getCellBonus = function(row, col) {
            return bonuses[row][col];
        }
    };

    wm.scribble.Tile = function(letter, cost) {
        var element;
        var pinned = false;
        var selected = false;
        var tile = this;

        var backgroundPosition = 0;

        var validateTile = function() {
            element.style.backgroundPosition = "-" + (cost * 22) + "px " + backgroundPosition + "px";
        };

        this.select = function() {
            this.selected = true;
            backgroundPosition -= 22;
            validateTile();
        };

        this.deselect = function() {
            this.selected = false;
            backgroundPosition += 22;
            validateTile();
        };

        this.pin = function() {
            this.pinned = true;
            backgroundPosition -= 44;
            validateTile();
        };

        this.getElement = function() {
            return element;
        };

        element = function() {
            var element = document.createElement('div');
            element.onclick = function() {
                if (tile.selected) {
                    tile.deselect();
                } else {
                    tile.select();
                }
            };
            element.id = "tile12";
            element.className = "tile";
            if (letter != null) {
                element.innerHTML = letter;
            }
            return element;
        }();
        validateTile();
    };

    wm.scribble.Board = function() {
        var scoreEngine = new wm.scribble.ScoreEngine();

        this.init = function() {
            var board = document.getElementById('board');
            for (var i = 0; i < 15; i++) {
                var row = document.createElement('tr');
                board.appendChild(row);
                for (var j = 0; j < 15; j++) {
                    var cell = createCellElement(i, j);
//                    var t1 = new wm.scribble.Tile('A', 4);
//                    cell.appendChild(t1.getElement());
                    row.appendChild(cell);
                }
            }

            var hand = document.getElementById('hand');
            for (var k = 0; k < 7; k++) {
                var t2 = new wm.scribble.Tile('', k);
                t2.pin();
                hand.appendChild(t2.getElement());
            }
        };

        this.getScoreEngine = function() {
            return scoreEngine;
        };

        var createCellElement = function(row, col) {
            var bonus = scoreEngine.getCellBonus(row, col);

            var cell = document.createElement('td');
            cell.id = "cell_" + row + "_" + col;
            cell.className = "cell" + (bonus != null ? " bonus-cell-" + bonus.name : "");
            return cell;
        };

        var createTileElement = function(letter, cost) {
            var cell = document.createElement('div');
            cell.id = "tile12";
            cell.className = "tile";
            if (letter != null) {
                cell.innerHTML = letter;
            }
            cell.style.backgroundPosition = "-" + (cost * 22) + "px 0px";
            return cell;
        }
    };
</script>

<div id="playboard">
    <table id="board" cellpadding="0" cellspacing="0" border="0">
    </table>

    <table id="hand" cellpadding="0" cellspacing="0" border="0">
    </table>
</div>

<!--
<div id="playboard">

</div>
-->

<script type="text/javascript">
    var board = new wm.scribble.Board();
    board.init();
</script>

</body>
</html>